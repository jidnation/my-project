import 'dart:convert';

import 'package:flutter/material.dart';
import 'package:my_project/Models/json_formatter.dart';
import 'package:my_project/file_manager.dart';

class FileController extends ChangeNotifier {
  List<User> _userList = <User>[];
  get users => _userList;

  // User _user = User(userName: 'JidNation1', password: '12345678');
  // User get user => _user;

  readUser() async {
    // _userList.add(User.fromJson(await FileManager().readJsonFile()));
    print('from controller: ${_userList.length}');
    notifyListeners();

    // print('from controller: ${_userList[0].userName}');
    // if (_userList.length > 1) {
    //   print('from controller: ${_userList[1].password}');
    // }
    // // return null;
  }

  writeUser(User newUser) async {
    _userList = (await FileManager().writeJsonFile(newUser));
    notifyListeners();
    // _userList.add(newUser);
    // print('fromControllerWritter: ${_userList.length}');
    // print(UserList.fromJson(_userList)); //Trying to convert it to string
    // print(_userList[1].userName);
  }
}





  // Positioned(
        //   top: 0,
        //   right: 0,
        //   child: Container(
        //     padding: const EdgeInsets.all(2),
        //     width: 18,
        //     height: 18,
        //     decoration: BoxDecoration(
        //       color: Colors.red.shade700,
        //       borderRadius: BorderRadius.circular(50),
        //     ),
        //     child: const Center(
        //       child: Text('10',
        //           style: TextStyle(
        //               color: Colors.white,
        //               fontSize: 10,
        //               fontFamily: 'Lobster',
        //               fontWeight: FontWeight.bold)),
        //     ),
        //   ),
        // ),










import 'dart:convert';
import 'dart:io';

import 'package:my_project/Models/json_formatter.dart';
import 'package:path_provider/path_provider.dart';

class FileManager {
  Future<String> get _directoryPath async {
    Directory? directory = await getExternalStorageDirectory();

    return directory!.path;
  }

  ///Tto get / create file from/to the directory

  Future<File> get _jsonFile async {
    // String newPath = '';
    final _path = await _directoryPath;
    // List<String> paths = _path.split('/');

    // for (int i = 1; i < paths.length; i++) {
    //   if (paths[i] != 'Android') {
    //     newPath += '/' + paths[i];
    //   } else {
    //     newPath += '/INReport';
    //     break;
    //   }
    // }
    // print(_path);
    return File('$_path/userList.json');
  }

  ///Creating the required methods to read and write into the file

  readJsonFile() async {
    String fileContent;

    File file = await _jsonFile;

    if (await file.exists()) {
      fileContent = await file.readAsString();
      // UserList a = (fileContent) as [];
      // print('fileContent: ${json.decode(fileContent)}');
      // print(fileContent.runtimeType);
      print('from manager:$fileContent');
      return json.decode(fileContent);
    }
  }

  writeJsonFile(User user) async {
    String fileContent;
      var usersList = UserList(users: <User>[]);

    File file = await _jsonFile;

    if (await file.exists()) {
      fileContent = await file.readAsString(); //String
    // _userList.add(User.fromJson(await FileManager().readJsonFile()));

      User user = User.fromJson(jsonDecode(fileContent));

      usersList.users.add(user);
      // print(user.userName);
      return usersList.users;
    }

    // final User user = User(userName: 'Adeola', password: 'Adeola123');
    // var result;
    // UserList results;
    // File file = await _jsonFile;
    // String fileString = await file.readAsString();
    // result = User.fromJson(json.decode(fileString));
    // results = UserList.fromJson(result);
    // results.users.add(user);
    // await file.writeAsString(json.encode(results.users));
    // print(results);
    // return results.users;
  }
}
